<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mi sitio</title>
  <style>
    body { font-family: Arial; margin: 0; }
    .container { max-width: 1000px; margin: 0 auto; padding: 16px; }
    .banner { padding: 48px 16px; background:#f3f3f3; }
    .cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap: 12px; }
    .card { padding: 16px; border:1px solid #ddd; border-radius: 12px; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const renderers = {
      banner: (props) => `
        <section class="banner">
          <div class="container">
            <h1>${escapeHtml(props.title || "")}</h1>
            <p>${escapeHtml(props.subtitle || "")}</p>
          </div>
        </section>
      `,
      cards: (props) => {
        const items = props.items || [];
        return `
          <section class="container">
            <div class="cards">
              ${items.map(i => `
                <div class="card">
                  <h3>${escapeHtml(i.title || "")}</h3>
                  <p>${escapeHtml(i.text || "")}</p>
                </div>
              `).join("")}
            </div>
          </section>
        `;
      }
    };

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, s => ({
        "&":"&amp;", "<":"&lt;", ">":"&gt;", '"':"&quot;", "'":"&#39;"
      }[s]));
    }

    async function main() {
      const res = await fetch("/api/site");
      const site = await res.json();

      document.title = site.meta?.title || "Mi sitio";

      const html = (site.sections || [])
        .map(sec => {
          const fn = renderers[sec.type];
          return fn ? fn(sec.props || {}) : "";
        })
        .join("");

      document.getElementById("app").innerHTML =
        html || `<div class="container"><h2>No hay bloques publicados</h2><p>Entra a <b>/admin</b>, agrega bloques y presiona <b>Publicar</b>.</p></div>`;
    }

    main().catch(err => {
      document.getElementById("app").innerHTML =
        `<div class="container"><h2>Error renderizando</h2><pre>${err}</pre></div>`;
      console.error(err);
    });
  </script>
</body>
</html>
